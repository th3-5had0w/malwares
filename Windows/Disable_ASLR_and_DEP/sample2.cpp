#include <Windows.h>
#include <imagehlp.h>
#include <iostream>

#pragma comment(lib, "imagehlp.lib")

bool flag(LPSTR path, bool ASLR, bool DEP){
    LOADED_IMAGE PE;
    if (MapAndLoad(path, 0, &PE, 0, 0)){
        if (ASLR){
            PE.FileHeader->OptionalHeader.DllCharacteristics = IMAGE_DLLCHARACTERISTICS_DYNAMIC_BASE;
        }
        else PE.FileHeader->OptionalHeader.DllCharacteristics = NULL;

        if (DEP){
            PE.FileHeader->OptionalHeader.DllCharacteristics = IMAGE_DLLCHARACTERISTICS_NX_COMPAT;
        }
        else PE.FileHeader->OptionalHeader.DllCharacteristics = NULL;

        UnMapAndLoad(&PE);
        return true;
    }
    return false;
}

int main(){
    char prog_name[30];
    std::cout << "Enter program name: ";
    std::cin >> prog_name;

    if(flag(prog_name, false, false)){
        std::cout << "[+] Successfully turned off ASLR & DEP!" << std::endl;
        std::cout << "Press ENTER to close this window..." << std::endl;
        getchar();
    }
    else{
        std::cout << "[-] Failed!" << std::endl;
        std::cout << "Press ENTER to close this window..." << std::endl;
        getchar();
    }
}